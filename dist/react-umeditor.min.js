!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.editor=e()}}(function(){return function e(t,n,o){function i(r,s){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[r]={exports:{}};t[r][0].call(l.exports,function(e){var n=t[r][1][e];return i(n?n:e)},l,l.exports,e,t,n,o)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,t,n){(function(n){"use strict";var o="undefined"!=typeof window?window.React:"undefined"!=typeof n?n.React:null,i=e("./Dropdown.react"),a=e("../constants/EditorConstants"),r=a.ColorTypes,s=o.createClass({displayName:"ColorDropdown",getInitialState:function(){return{handle:function(){}}},open:function(e,t){this.setState({handle:t}),this.refs.root.open(e)},close:function(){this.refs.root.close()},toggle:function(e){this.refs.root.toggle(e)},handleSelectColor:function(e){e=e||event;var t=e.target||e.srcElement,n=t.getAttribute("data-color");this.state.handle&&this.state.handle(e,n),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.close()},render:function(){var e=this.handleSelectColor;return o.createElement(i,{ref:"root",className:"color-dropdown"},o.createElement("table",null,o.createElement("tr",{className:"title-row"},o.createElement("td",{colSpan:10},"主题颜色")),r.themeColors.map(function(t,n){var i=0==n;return o.createElement("tr",{className:i?"first-row":""},t.map(function(t){return o.createElement("td",null,o.createElement("a",{className:"color-anchor","data-color":t,style:{backgroundColor:t},onClick:e}))}))}),o.createElement("tr",{className:"title-row"},o.createElement("td",{colSpan:10},"标准颜色")),o.createElement("tr",{className:"last-row"},r.standardColors.map(function(t){return o.createElement("td",null,o.createElement("a",{className:"color-anchor","data-color":t,style:{backgroundColor:t},onClick:e}))}))))}});t.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../constants/EditorConstants":3,"./Dropdown.react":2}],2:[function(e,t,n){(function(e){"use strict";function n(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i="undefined"!=typeof window?window.React:"undefined"!=typeof e?e.React:null,a=i.createClass({displayName:"Dropdown",getInitialState:function(){return{show:!1,position:{x:0,y:0}}},componentDidMount:function(){window.addEventListener("click",this.close)},componentWillUnmount:function(){window.removeEventListener("click",this.close)},open:function(e){this.setState({show:!0,position:e})},close:function(){this.setState({show:!1})},toggle:function(e){this.setState({show:!this.state.show,position:e})},render:function(){var e=this.props,t=e.className,a=e.style,r=n(e,["className","style"]);return a=a||{},this.state.show?a.display="":a.display="none",this.state.position&&(a.left=this.state.position.x,a.top=this.state.position.y),i.createElement("div",o({style:a,className:"dropdown"+(t?" "+t:"")},r),i.createElement("div",{className:"dropdown-caret"}),this.props.children)}});t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){"use strict";var o={source:{title:"源代码",disabled:!1},separator:{disabled:!1},undo:{title:"撤销",disabled:!1},redo:{title:"重做",disabled:!1},bold:{title:"加粗",disabled:!1},italic:{title:"斜线",disabled:!1},underline:{title:"下划线",disabled:!1},strikethrough:{title:"删除线",disabled:!1},superscript:{title:"上标",disabled:!1},subscript:{title:"下标",disabled:!1},forecolor:{title:"字体颜色",disabled:!1},backcolor:{title:"背景色",disabled:!1},removeformat:{title:"清除格式",disabled:!1},insertunorderedlist:{title:"无序列表",disabled:!1},insertorderedlist:{title:"有序列表",disabled:!1},selectall:{title:"全选",disabled:!1},cleardoc:{title:"清空文档",disabled:!1},paragraph:{title:"段落格式",disabled:!1},fontfamily:{title:"字体",disabled:!1},fontsize:{title:"字号",disabled:!1},justifyleft:{title:"居左对齐",disabled:!1},justifycenter:{title:"居中对齐",disabled:!1},justifyright:{title:"居右对齐",disabled:!1},link:{title:"超链接",disabled:!1},unlink:{title:"取消链接",disabled:!1},emotion:{title:"表情",disabled:!1},image:{title:"图片",disabled:!1},video:{title:"视频",disabled:!1},map:{title:"百度地图",disabled:!1},horizontal:{title:"分隔线",disabled:!1},print:{title:"打印",disabled:!1},preview:{title:"预览",disabled:!1},drafts:{title:"草稿箱",disabled:!1},formula:{title:"数学公式",disabled:!1}},i={themeColors:[["#fff","#000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646"],["#f2f2f2","7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada"],["#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5"],["#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#92cddc","#fac08f"],["#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#31859b","#e36c09"],["#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#205867","#974806"]],standardColors:["#c00000","#ff0000","#ffc000","#ffff00","#92d050","#00b050","#00b0f0","#0070c0","#002060","#7030a0"]};t.exports={EditorIconTypes:o,ColorTypes:i}},{}],4:[function(e,t,n){(function(n){"use strict";function o(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a="undefined"!=typeof window?window.React:"undefined"!=typeof n?n.React:null,r=e("react-dom"),s=e("./constants/EditorConstants"),c=s.EditorIconTypes,d=e("./utils/EditorHistory"),l=e("./utils/EditorSelection"),f=e("./components/ColorDropdown.react"),u=a.createClass({displayName:"EditorIcon",handleClick:function(e){var t=this.props,n=(t.onClick,o(t,["onClick"]));this.props.onClick&&this.props.onClick(e,i({},n))},render:function(){var e=this.props,t=e.icon,n=e.active,r=e.disabled,s=e.showHtml,c=(e.onClick,o(e,["icon","active","disabled","showHtml","onClick"])),d=s&&"source"!=t&&"separator"!=t;return a.createElement("span",i({className:"editor-icon icon-"+t+(n?" active":"")+(r||d?" disabled":""),onClick:this.handleClick},c))}}),h=a.createClass({displayName:"EditorToolbar",getInitialState:function(){return{icons:["source | undo redo | bold italic underline strikethrough | superscript subscript | ","forecolor backcolor | removeformat | insertorderedlist insertunorderedlist | selectall | ","cleardoc | paragraph fontfamily fontsize | justifyleft justifycenter justifyright | link unlink | ","emotion image video | map | horizontal print preview drafts formula"],selection:null}},handleIconClick:function(e,t){this.props.onIconClick&&this.props.onIconClick(e,t)},getIcons:function(){var e=this.props.editorState;e.icons.undo={disabled:!d.canUndo()},e.icons.redo={disabled:!d.canRedo()};var t=this.state.icons,n=t.join(" ").replace(/\|/gm,"separator").split(" ");n=n.filter(function(e){return""!=e});for(var o=[],i=0;i<n.length;i++)o[i]=c[n[i]],o[i].onClick=this.handleIconClick,o[i].icon=n[i],e.icons[n[i]]&&(o[i].disabled=!!e.icons[n[i]].disabled,o[i].active=!!e.icons[n[i]].active),o[i].showHtml=!!e.showHtml;return o},render:function(){var e=this.getIcons();return a.createElement("div",{className:"editor-toolbar"},e.map(function(e){var t=e;return a.createElement(u,t)}))}}),m=a.createClass({displayName:"EditorTextArea",getInitialState:function(){return{content:""}},getContent:function(){var e=r.findDOMNode(this.refs.root);return e.value},setContent:function(e){this.setState({content:e})},getName:function(){return"textarea"},handleChange:function(){var e=r.findDOMNode(this.refs.root);this.setState({content:e.value})},render:function(){return a.createElement("textarea",{ref:"root",className:"editor-textarea",value:this.state.content,onChange:this.handleChange})}}),p=a.createClass({displayName:"EditorContentEditableDiv",getInitialState:function(){return{content:""}},componentDidMount:function(e){window.addEventListener("mousedown",this.handleWindowMouseDown)},componentWillUpdate:function(e){l.addRange()},componentDidUpdate:function(e){l.addRange()},getContent:function(){var e=r.findDOMNode(this.refs.root);return e.innerHTML},setContent:function(e){this.setState({content:e})},getName:function(){return"div"},handleWindowMouseDown:function(e){l.clearRange()},handleMouseDown:function(e){l.clearRange(),window.addEventListener("mouseup",this.handleMouseUp)},handleMouseUp:function(e){l.createRange(),this.props.onRangeChange&&this.props.onRangeChange(e),window.removeEventListener("mouseup",this.handleMouseUp)},render:function(){return a.createElement("div",{ref:"root",className:"editor-contenteditable-div",onMouseUp:this.handleMouseUp,onMouseDown:this.handleMouseDown,contentEditable:!0,dangerouslySetInnerHTML:{__html:this.state.content}})}}),g=a.createClass({displayName:"Editor",getInitialState:function(){return{editorState:{showHtml:!1,icons:{}}}},componentDidMount:function(){d.clear(),this.refs.editarea.setContent(this.props.defaultContent?this.props.defaultContent:"<p>This is an Editor</p>")},componentDidUpdate:function(){var e=this.state.editorState;switch(e.icon){case"source":this.refs.editarea.setContent(e.content)}},genEditArea:function(){var e=this.state.editorState.showHtml;return e?a.createElement(m,{ref:"editarea"}):a.createElement(p,{ref:"editarea",onRangeChange:this.handleRangeChange})},exchangeRangeState:function(e){var t=l.getRangeState();for(var n in t)e.icons[n]?e.icons[n].active=t[n].active:e.icons[n]=t[n];return e},handleRangeChange:function(){var e=this.state.editorState;e=this.exchangeRangeState(e),this.setState({editorState:e})},getOffsetRootParentPosition:function(e){var t={x:0,y:0,w:0,h:0},n=r.findDOMNode(this.refs.root);t.w=e.offsetWidth,t.h=e.offsetHeight,t.x=e.offsetLeft,t.y=e.offsetTop;for(var o=e.offsetParent;o!=n;)t.x+=o.offsetLeft,t.y+=o.offsetTop,o=o.offsetParent;return t},handleToolbarIconClick:function(e,t){e=e||event;var n=e.target||e.srcElement,o=this.getOffsetRootParentPosition(n),i=this.state.editorState;switch(l.addRange(),t.icon){case"source":i.showHtml=!i.showHtml,t.active=i.showHtml,i.content=this.refs.editarea.getContent();break;case"undo":d.undo();break;case"redo":d.redo();break;case"bold":case"italic":case"underline":case"strikethrough":case"subscript":case"superscript":case"unlink":d.execCommand(t.icon,!1,null);break;case"link":d.execCommand(t.icon,!0,null);break;case"forecolor":o.y+=o.h+5,this.refs.color.open(o,function(e,t){d.execCommand("forecolor",!1,t)});break;case"backcolor":o.y+=o.h+5,this.refs.color.open(o,function(e,t){d.execCommand("backcolor",!1,t)})}i.icons[t.icon]=t,i.icon=t.icon,l.createRange(),i=this.exchangeRangeState(i),this.setState({editorState:i}),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},render:function(){var e=this.genEditArea();return a.createElement("div",{ref:"root",className:"editor-container editor-default",onBlur:this.handleRangeChange},a.createElement(h,{editorState:this.state.editorState,onIconClick:this.handleToolbarIconClick}),e,a.createElement(f,{ref:"color"}))}});t.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./components/ColorDropdown.react":1,"./constants/EditorConstants":3,"./utils/EditorHistory":5,"./utils/EditorSelection":6,"react-dom":void 0}],5:[function(e,t,n){"use strict";var o={curCommand:null,commandStack:[],commandIndex:-1,canUndo:function(){return this.commandStack.length>0&&-1!=this.commandIndex},canRedo:function(){return this.commandStack.length>0&&this.commandIndex!=this.commandStack.length-1},undo:function(){return this.canUndo()&&(this.commandIndex=this.commandIndex-1,this.curCommand=this.commandStack[this.commandIndex],document.execCommand("undo")),this.canUndo()},redo:function(){return this.canRedo()&&(this.commandIndex=this.commandIndex+1,this.curCommand=this.commandStack[this.commandIndex],document.execCommand("redo")),this.canRedo()},execCommand:function(e,t,n){this.commandIndex=this.commandIndex+1,this.curCommand={command:e,flag:t,args:n},this.commandStack.splice(this.commandIndex,this.commandStack.length-this.commandIndex),this.commandStack[this.commandIndex]={command:e,flag:t,args:n},document.execCommand(e,t,n)},getCurCommand:function(){return this.curCommand},getCommandStack:function(){return this.commandStack},getCommandIndex:function(){return this.commandIndex},clear:function(){this.curCommand=null,this.commandStack=[],this.commandIndex=-1}};t.exports=o},{}],6:[function(e,t,n){"use strict";var o={range:null,selection:null,getSelection:function(){return window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection?document.selection.createRange():null},addRange:function(){this.selection=this.getSelection(),this.selection.removeAllRanges(),this.selection&&this.range&&(this.selection.addRange(this.range.cloneRange()),this.range=this.range.cloneRange())},createRange:function(){this.selection=this.getSelection(),this.selection&&this.selection.rangeCount>0?this.range=this.selection.getRangeAt(0).cloneRange():this.range=null},clearRange:function(){this.selection=this.getSelection(),this.selection.removeAllRanges()},getRangeState:function(){for(var e={},t="bold italic underline strikethrough",n=t.split(" "),o=0;o<n.length;o++)e[n[o]]={icon:n[o],active:!1};if(this.range)for(var i=this.range.startContainer.parentElement;"DIV"!=i.tagName.toUpperCase();){switch(i.tagName.toUpperCase()){case"I":e.italic={active:!0,icon:"italic"};break;case"B":e.bold={active:!0,icon:"bold"};break;case"U":e.underline={active:!0,icon:"underline"};break;case"STRIKE":e.strikethrough={active:!0,icon:"strikethrough"};break;case"SUP":e.superscript={active:!0,icon:"superscript"};break;case"SUB":e.subscript={active:!0,icon:"subscript"}}i=i.parentElement}return e}};t.exports=o},{}]},{},[4])(4)});